<br>
<div class="container" *ngIf="site">
  <h4>Questionnaire simplifié de la {{site.type_rn}} {{site.jonction_nom}}{{site.nom}}</h4>
  <br>
  <form [formGroup]="tInfosBaseSiteForm" (ngSubmit)="onSubmit()">
    <input type="hidden" formControlName="id_site">

    <!-- Question 1 -->
    <!-- Question 1 -->
    <div class="form-group">
      <h6>La réserve a t'elle été créée sur le fondement d’un patrimoine géologique ?</h6>
      <div>
        <mat-radio-group class="color-button" formControlName="reserve_created_on_geological_basis">
          <mat-radio-button [value]="true">Oui</mat-radio-button>
          <mat-radio-button [value]="false">Non</mat-radio-button>
        </mat-radio-group>
      </div>
    </div>

    <div class="form-group sites-inpg">
      <h6>Patrimoine géologique</h6>
      <div>
        <h6 *ngIf="site.inpg.length > 0">La réserve abrite {{site.inpg.length}} site<span
            *ngIf="site.inpg.length > 1">s</span> INPG <a (click)="changeInpgView()" *ngIf="site.inpg.length > 5"><span
              *ngIf="!showInpg">Afficher</span><span *ngIf="showInpg">Masquer</span> les sites</a></h6>
        <h6 *ngIf="site.inpg.length == 0">La réserve n'abrite aucun site INPG</h6>
        <div *ngIf="site.inpg && site.inpg.length > 0 && showInpg">
          <div *ngFor="let inpg of site.inpg">
            <fa-icon [icon]="['fas', 'star']" size="2xs"></fa-icon>
            <fa-icon *ngIf="inpg.nombre_etoiles > 1; else etoileVide2" [icon]="['fas', 'star']" size="2xs">
            </fa-icon>
            <ng-template #etoileVide2>
              <fa-icon [icon]="['far', 'star']" size="2xs"></fa-icon>
            </ng-template>
            <fa-icon *ngIf="inpg.nombre_etoiles > 2; else etoileVide3" [icon]="['fas', 'star']" size="2xs">
            </fa-icon>
            <ng-template #etoileVide3>
              <fa-icon [icon]="['far', 'star']" size="2xs"></fa-icon>
            </ng-template>
            <a [href]="'https://inpn.mnhn.fr/site/inpg/' + inpg.id_metier" target="_blank"> {{
              inpg.lb_site }}</a>
            {{ inpg.interet_geol_principal }}
          </div>
        </div>
        <br>
        <h6 *ngIf="geologicalHeritages.controls.length > 0">Autre<span
            *ngIf="geologicalHeritages.controls.length > 1">s</span> patrimoine<span
            *ngIf="geologicalHeritages.controls.length > 1">s</span> géologique<span
            *ngIf="geologicalHeritages.controls.length > 1">s</span> sur la réserve : </h6>
        <div formArrayName="geologicalHeritages" *ngFor="let heritage of geologicalHeritages.controls; let i = index">
          <div [formGroupName]="i" class="heritage-entry">
            <button mat-icon-button class="remove-button" (click)="removeHeritage(i)">
              <mat-icon>delete</mat-icon>
            </button>
            <mat-form-field appearance="fill">
              <mat-label>Libellé</mat-label>
              <input matInput formControlName="lb" required>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Intérêt Géologique Principal</mat-label>
              <mat-select formControlName="interet_geol_principal" required>
                <mat-option *ngFor="let option of geologicalInterestOptions" [value]="option">
                  {{ option }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Âge des Terrains le Plus Récent</mat-label>
              <input matInput formControlName="age_des_terrains_le_plus_recent">
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Âge des Terrains le Plus Ancien</mat-label>
              <input matInput formControlName="age_des_terrains_le_plus_ancien">
            </mat-form-field>
            <mat-form-field appearance="fill" class="bibliographie-field">
              <mat-label>Bibliographie</mat-label>
              <textarea matInput formControlName="bibliographie" required></textarea>
            </mat-form-field>
          </div>
        </div>
        <div class="button-container">
          <button mat-raised-button color="primary" (click)="ajouterPatrimoineGeol()">
            Ajouter un patrimoine géologique à la réserve
          </button>
        </div>
      </div>
    </div>



    <!-- Question 3 -->
    <div class="form-group sites-inpg" *ngIf="site.perimetre_protection">
      <h6 *ngIf="site.perimetre_protection.inpg.length > 0">Le périmètre de protection de la réserve abrite
        {{site.perimetre_protection.inpg.length}} site<span *ngIf="site.perimetre_protection.inpg.length > 1">s</span>
        INPG <a (click)="changePpInpgView()" *ngIf="site.perimetre_protection.inpg.length > 5"><span
            *ngIf="!showPpInpg">Afficher</span><span *ngIf="showPpInpg">Masquer</span> les sites</a></h6>
      <h6 *ngIf="site.perimetre_protection.inpg.length == 0">Le périmètre de protection de la réserve n'abrite aucun
        site INPG</h6>
      <div *ngIf="site.perimetre_protection.inpg && site.perimetre_protection.inpg.length > 0 && showPpInpg">
        <div *ngFor="let inpg of site.perimetre_protection.inpg">
          <fa-icon [icon]="['fas', 'star']" size="2xs"></fa-icon>
          <fa-icon *ngIf="inpg.nombre_etoiles > 1; else etoileVide2" [icon]="['fas', 'star']" size="2xs">
          </fa-icon>
          <ng-template #etoileVide2>
            <fa-icon [icon]="['far', 'star']" size="2xs"></fa-icon>
          </ng-template>
          <fa-icon *ngIf="inpg.nombre_etoiles > 2; else etoileVide3" [icon]="['fas', 'star']" size="2xs">
          </fa-icon>
          <ng-template #etoileVide3>
            <fa-icon [icon]="['far', 'star']" size="2xs"></fa-icon>
          </ng-template>
          <a [href]="'https://inpn.mnhn.fr/site/inpg/' + inpg.id_metier" target="_blank"> {{
            inpg.lb_site }}</a>
          {{ inpg.interet_geol_principal }}
        </div>
      </div>
      <br>
      <h6 *ngIf="protectionGeologicalHeritages.controls.length > 0">Autre<span
          *ngIf="protectionGeologicalHeritages.controls.length > 1">s</span> patrimoine<span
          *ngIf="protectionGeologicalHeritages.controls.length > 1">s</span> géologique<span
          *ngIf="protectionGeologicalHeritages.controls.length > 1">s</span> sur le périmètre de protection de la
        réserve : </h6>
      <div>
        <div formArrayName="protection_geologicalHeritages"
          *ngFor="let heritage of protectionGeologicalHeritages.controls; let i = index">
          <div [formGroupName]="i" class="heritage-entry">
            <button mat-icon-button class="remove-button" (click)="removeProtectionHeritage(i)">
              <mat-icon>delete</mat-icon>
            </button>
            <mat-form-field appearance="fill">
              <mat-label>Libellé</mat-label>
              <input matInput formControlName="lb" required>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Intérêt Géologique Principal</mat-label>
              <mat-select formControlName="interet_geol_principal" required>
                <mat-option *ngFor="let option of geologicalInterestOptions" [value]="option">
                  {{ option }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Âge des Terrains le Plus Récent</mat-label>
              <input matInput formControlName="age_des_terrains_le_plus_recent">
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Âge des Terrains le Plus Ancien</mat-label>
              <input matInput formControlName="age_des_terrains_le_plus_ancien">
            </mat-form-field>

            <mat-form-field appearance="fill" class="bibliographie-field">
              <mat-label>Bibliographie</mat-label>
              <textarea matInput formControlName="bibliographie" required></textarea>
            </mat-form-field>
          </div>
        </div>
        <div class="button-container">
          <button mat-raised-button color="primary" (click)="ajouterPatrimoineGeolPP()">
            Ajouter un patrimoine géologique au périmètre de protection
          </button>
        </div>
      </div>
    </div>

    <!-- Question 5 -->
    <div class="form-group" formGroupName="contains_paleontological_heritage">
      <label>
        <h6>Est-ce que les terrains de la réserve renferment du patrimoine paléontologique ?</h6>
      </label>
      <div>
        <mat-radio-group formControlName="answer">
          <mat-radio-button [value]="true">Oui</mat-radio-button>
          <mat-radio-button [value]="false">Non</mat-radio-button>
        </mat-radio-group>
        <div *ngIf="tInfosBaseSiteForm.get('contains_paleontological_heritage')?.get('answer')?.value">
          <mat-checkbox formControlName="vertebrates">Vertébrés</mat-checkbox>
          <mat-checkbox formControlName="invertebrates">Invertébrés</mat-checkbox>
          <mat-checkbox formControlName="plants">Végétaux</mat-checkbox>
          <mat-checkbox formControlName="traceFossils">Traces fossiles</mat-checkbox>
          <mat-checkbox formControlName="other">Autre</mat-checkbox>
        </div>
        <mat-form-field appearance="fill"
          *ngIf="tInfosBaseSiteForm.get('contains_paleontological_heritage')?.get('other')?.value">
          <mat-label>Préciser le autre</mat-label>
          <input matInput formControlName="otherDetails">
        </mat-form-field>
      </div>
    </div>

    <!-- Question 6 -->
    <div class="form-group">
      <label>
        <h6>Est-ce que la réserve dispose de collections géologiques propres ?</h6>
      </label>
      <div>
        <mat-radio-group formControlName="reserve_has_geological_collections">
          <mat-radio-button [value]="false">Non</mat-radio-button>
          <mat-radio-button [value]="true">Oui</mat-radio-button>
        </mat-radio-group>
      </div>
    </div>

    <!-- Question 7 -->
    <div class="form-group">
      <label>
        <h6>Est-ce que la réserve dispose d’un lieu d’exposition de collections géologiques ?</h6>
      </label>
      <div>
        <mat-radio-group formControlName="reserve_has_exhibition">
          <mat-radio-button [value]="false">Non</mat-radio-button>
          <mat-radio-button [value]="true">Oui</mat-radio-button>
        </mat-radio-group>
      </div>
    </div>
    <!-- TODO: ajouter tableu de cores pour stocke les repens choisie et garder dans mini question pour question 8-1 -->
    <!--question remplace  la question 8-1 -->
    <div class="form-group">
      <label>
        <h6>A quel(s) ensemble(s) géologique(s) la réserve naturelle est-elle associée ?</h6>
      </label>
    </div>
    <!-- <mat-form-field appearance="fill" class="ensemble-geol">
      <mat-label>Sélectionner les ensembles géologiques</mat-label>
      <mat-select formControlName="geologicalUnits" multiple>
        <mat-option *ngFor="let unit of geologicalUnitsOptions" [value]="unit.id_nomenclature">
          {{ unit.label }}
        </mat-option>
      </mat-select>
    </mat-form-field> -->
    <div formArrayName="geologicalUnits" class="checkbox-geologicalUnits">
      <div *ngFor="let unit of geologicalUnitsOptions; let i = index">
        <mat-checkbox [formControlName]="i">
          {{ unit.label }}
        </mat-checkbox>
      </div>
    </div>
    <br>


    <!-- Question 9 -->
    <div class="form-group">
      <label>
        <h6>Est-ce que la réserve abrite un stratotype ?</h6>
      </label>
      <div>
        <mat-radio-group formControlName="reserve_contains_stratotype">
          <mat-radio-button [value]="true">Oui</mat-radio-button>
          <mat-radio-button [value]="false">Non</mat-radio-button>
        </mat-radio-group>
        <div *ngIf="tInfosBaseSiteForm.get('reserve_contains_stratotype')?.value">
          <mat-checkbox formControlName="stratotype_limit">Stratotype de limite</mat-checkbox>
          <div *ngIf="tInfosBaseSiteForm.get('stratotype_limit')?.value">
            <mat-form-field>
              <mat-label>Préciser le ou les stratotypes concernés</mat-label>
              <input matInput formControlName="stratotype_limit_input">
            </mat-form-field>
          </div>
          <mat-checkbox formControlName="stratotype_stage">Stratotype d’étage</mat-checkbox>
          <div *ngIf="tInfosBaseSiteForm.get('stratotype_stage')?.value">
            <mat-form-field>
              <mat-label>Préciser le ou les stratotypes concernés</mat-label>
              <input matInput formControlName="stratotype_stage_input">
            </mat-form-field>
          </div>
        </div>
      </div>
    </div>

    <!-- TODO: ajouter tableu de cores pour stocke les repens choisie et garder dans mini question pour question 10 -->
    <!-- Question 10 -->
    <div class="form-group">
      <label>
        <h6>Est-ce que la réserve présente des milieux souterrains abritant un patrimoine naturel identifié, biologique
          ou géologique ?</h6>
      </label>
      <div>
        <mat-radio-group formControlName="contains_subterranean_habitats">
          <mat-radio-button [value]="true">Oui</mat-radio-button>
          <mat-radio-button [value]="false">Non</mat-radio-button>
        </mat-radio-group>
        <div *ngIf="tInfosBaseSiteForm.get('contains_subterranean_habitats')?.value">
          <mat-checkbox formControlName="subterranean_habitats_natural_cavities">Cavités naturelles</mat-checkbox>
          <mat-checkbox formControlName="subterranean_habitats_anthropogenic_cavities">Cavités
            anthropiques</mat-checkbox>
        </div>
      </div>
    </div>
    <!-- Question 11 modifiée avec un container -->
    <div class="form-group">
      <label>
        <h6>La réserve est-elle associée à une exploitation de ressources minérales ?</h6>
      </label>
      <div>
        <mat-radio-group formControlName="associated_with_mineral_resources">
          <mat-radio-button [value]="true">Oui</mat-radio-button>
          <mat-radio-button [value]="false">Non</mat-radio-button>
        </mat-radio-group>
        <div *ngIf="tInfosBaseSiteForm.get('associated_with_mineral_resources')?.value">
          <div>
            <mat-checkbox formControlName="mineral_resources_old_quarry">Ancienne carrière</mat-checkbox>
            <mat-checkbox formControlName="mineral_resources_active_quarry">Carrière en activité</mat-checkbox>
            <mat-checkbox formControlName="mineral_resources_old_mine">Ancienne mine</mat-checkbox>
            <mat-checkbox formControlName="mineral_resources_active_mine">Mine en activité</mat-checkbox>
          </div>
          <div>
            <h6 *ngIf="quarryExtractedMaterials.controls.length > 0">Substances exploitées :</h6>
            <div formArrayName="quarry_extracted_materials">
              <div *ngFor="let material of quarryExtractedMaterials.controls; let i = index" [formGroupName]="i">
                <button mat-icon-button class="remove-button" (click)="removeSubstance(i)">
                  <mat-icon>delete</mat-icon>
                </button>
                <!-- <mat-form-field appearance="fill">
                  <mat-select formControlName="substance">
                    <mat-option *ngFor="let substance of substancesOptions" [value]="substance.mnemonique">
                      {{ substance.label }}
                    </mat-option>
                  </mat-select>
                </mat-form-field> -->
                <mat-form-field appearance="fill" class="substanceField">
                  <mat-select formControlName="substance">
                    <!-- Champ de recherche dans le menu déroulant -->
                    <mat-option>
                      <input type="text" placeholder="Rechercher..." [formControl]="searchSubstanceTerm"
                        (click)="$event.stopPropagation()" matInput class="search-input" />
                    </mat-option>

                    <!-- Liste des options filtrées -->
                    <mat-option *ngFor="let substance of filteredSubstancesOptions" [value]="substance.mnemonique">
                      {{ substance.label }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <label> Le matériau est-il fossilifère ? </label>
                <mat-radio-group formControlName="fossiliferous">
                  <mat-radio-button [value]="true">Oui</mat-radio-button>
                  <mat-radio-button [value]="false">Non</mat-radio-button>
                </mat-radio-group>
              </div>
            </div>
            <div class="button-container">
              <button mat-raised-button color="primary" (click)="addExtractedMaterial()">
                Ajouter une substance exploitée
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Question 12 -->
    <div class="form-group">
      <label>
        <h6>Est-ce que la réserve dispose d’un site géologique aménagé pour les visiteurs ?</h6>
      </label>
      <div>
        <mat-radio-group formControlName="reserve_has_geological_site_for_visitors">
          <mat-radio-button [value]="false">Non</mat-radio-button>
          <mat-radio-button [value]="true">Oui</mat-radio-button>
        </mat-radio-group>
      </div>
    </div>

    <!-- Question 13 -->
    <div class="form-group">
      <label>
        <h6>Est-ce que la réserve propose des animations sur la thématique géodiversité / patrimoine géologique ?</h6>
      </label>
      <div>
        <mat-radio-group formControlName="offers_geodiversity_activities">
          <mat-radio-button [value]="false">Non</mat-radio-button>
          <mat-radio-button [value]="true">Oui</mat-radio-button>
        </mat-radio-group>
      </div>
    </div>
    <div class="submit-button-container">
      <button mat-raised-button type="submit" [disabled]="tInfosBaseSiteForm.invalid">Enregistrer les
        modifications</button>
    </div>
  </form>
</div>
<br>